{% extends "template.html" %}

{% block content %}
  <div class="jumbo">
    <h2>ESP Part Number Standardization Tool</h2>
    <br/>
    <p>Click <a href="/welcome">here</a> to go to the welcome page</p>
    <p>Here is a table for your enjoyment:</p>
  </div>
  <body>
    <div class="btn-group dropup">

          <!-- <button type="button" class="btn btn-secondary">Action</button> -->
          <button type="button" class="btn btn-secondary dropdown-toggle dropdown-toggle-split" id="dropdownMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
            <span class="sr-only">Toggle Dropdown</span>
            Product Catagory
          </button>

          <a class="dropdown-item" href="#">Action</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="#">Another action</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="#">Something else here</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="#">Separated link</a>

    </div>
    <div class="p-4" style="width: 200px;">
      <form class="bd-search d-flex align-items-center" method="POST">
        {{ form.csrf_token }}
        {{ form.product_group }}
        {{ form.subcategory }}
        {{ form.optiontest }}
        <input type="submit">
      </form>
    </div>
    <script type="text/javascript">
      let product_group = document.getElementById('product_group');
      let subcategory = document.getElementById('subcategory');

      product_group.onchange = function(){
        product = product_group.value;

        fetch('/product_group/' + product).then(function(response) {
          response.json().then(function(data) {
            let optionHTML = '';
            // console.table(data.subcategories);
            for(let id of data.subcategories){
              // Inject new HTML Options for the subcategory selections
              optionHTML += '<option value="' + id.id + '">' + id.subcategory + '</option>';
              // subcategory here actually refers to the HTML select#subcategory id tag in the page
              subcategory.innerHTML = optionHTML;
            }

          });
        });
      }
    </script>

    <script type="text/javascript">
      let subcat = document.getElementById('subcategory');
      let optiontest = document.getElementById('optiontest');

      subcat.onchange = function(){
        subcat_name = subcategory.value;

        fetch('/subcat/' + subcat_name).then(
          function(response) {
            response.json().then(
            function(data) {
              let optionHTML = '';
              // console.table(data.subcategories);
              for(let id of data.options){
                console.log(id);
                // Inject new HTML Options for the subcategory selections
                optionHTML += '<option value="' + id.id + '">' + id.option + '</option>';
                // subcategory here actually refers to the HTML select#subcategory id tag in the page
                optiontest.innerHTML = optionHTML;
              }

          });
        });
      }

  </script>

   <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  </body>

{% endblock %}
